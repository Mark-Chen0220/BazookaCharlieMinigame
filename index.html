<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bazooka Charlie: Sky Ace</title>
  <style>
    canvas {
      display: block;
      margin: 0 auto;
      background: #a0d8ef;
      font-family: monospace;
    }
  </style>
</head>
<body>
    <canvas id="gameCanvas" width="480" height="640"></canvas>
    <!-- Button linking to Bazooka Charlie's Wikipedia -->
    <div style="text-align: center; margin-top: 10px;">
        <a href="https://en.wikipedia.org/wiki/Charles_Carpenter_(pilot)" 
        target="_blank"
        style="
            display: inline-block;
            padding: 10px 20px;
            background-color: #444;
            color: white;
            text-decoration: none;
            font-family: monospace;
            font-size: 16px;
            border-radius: 6px;
            transition: background-color 0.3s;
        "
        onmouseover="this.style.backgroundColor='#666'"
        onmouseout="this.style.backgroundColor='#444'">
        Learn about the real Bazooka Charlie
        </a>
    </div>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// === Constants ===
const gravity = 0.4;
const lift = -8;
const bgSpeed = 2;
const enemySpeed = 2;
const fireRate = 500;

// === Images ===
const imgPlane = new Image();
imgPlane.src = 'https://github.com/Mark-Chen0220/BazookaCharlieMinigame/blob/main/plane.png?raw=true';
const imgTank = new Image();
imgTank.src = 'https://github.com/Mark-Chen0220/BazookaCharlieMinigame/blob/main/tank.png?raw=true';
const imgHalftrack = new Image();
imgHalftrack.src = 'https://github.com/Mark-Chen0220/BazookaCharlieMinigame/blob/main/halftrack.png?raw=true';
const imgExplosion = new Image();
imgExplosion.src = 'https://github.com/Mark-Chen0220/BazookaCharlieMinigame/blob/main/explosion.png?raw=true';

// === Game State ===
let score = 0;
let lastShotTime = 0;
let gameState = 'menu'; // 'menu', 'playing', 'gameOver'

// === Player Plane ===
const plane = {
  x: 100,
  y: canvas.height / 2,
  width: 80,
  height: 80,
  velocityY: 0,
  angle: 0
};
let planeExploded = false;

// === Entities ===
let enemies = [];
let rockets = [];

// === Input Handling ===
document.addEventListener('keydown', (e) => {
  if (gameState === 'menu' && e.code === 'Enter') {
    startGame();
  } else if (gameState === 'playing' && e.code === 'Space') {
    plane.velocityY = lift;
    fireBazooka();
  } else if (gameState === "gameOver" && e.code === 'Enter') {
    startGame();
  }
});

function startGame() {
  gameState = 'playing';
  planeExploded = false;
  score = 0;
  enemies = [];
  rockets = [];
  plane.y = canvas.height / 2;
  plane.velocityY = 0;
  requestAnimationFrame(gameLoop);
}

// === Game Logic ===
function fireBazooka() {
  const now = Date.now();
  if (now - lastShotTime > fireRate) {
    const angleRad = (plane.angle * Math.PI) / 180;
    rockets.push({
      x: plane.x + plane.width,
      y: plane.y + plane.height / 2,
      width: 10,
      height: 4,
      speed: 6,
      dx: Math.cos(angleRad) * 6,
      dy: Math.sin(angleRad) * 6
    });
    lastShotTime = now;
  }
}

function spawnEnemy() {
  if (gameState !== 'playing') return;

  const type = Math.random() < 0.5 ? 'tank' : 'halftrack';
  const dimensions = type === 'tank' ? [62, 25] : [45, 18];
  enemies.push({
    type: type,
    x: canvas.width + Math.random() * 200,
    y: canvas.height - 40 - dimensions[1],
    width: dimensions[0],
    height: dimensions[1],
    hit: false
  });
}

function update() {
  if (gameState !== 'playing') return;

  // Plane motion
  plane.velocityY += gravity;
  plane.angle = Math.max(Math.min(plane.velocityY * 2, 30), -30);
  plane.y += plane.velocityY;

  if (plane.y + plane.height > canvas.height - 20) {
    plane.y = canvas.height - 20 - plane.height;
    plane.velocityY = 0;
    if (gameState !== 'gameOver') {
        gameState = 'gameOver';
        planeExploded = true;
        setTimeout(() => {
            planeExploded = false;
        }, 500); // explosion lasts half a second
    }
  }
  if (plane.y < 0) {
    plane.y = 0;
    plane.velocityY = 0;
  }

  // Rockets
  rockets = rockets.filter(r => r.x < canvas.width && !r.hit);
  for (let rocket of rockets) {
    rocket.x += rocket.dx;
    rocket.y += rocket.dy;
  }

  // Enemies
  enemies.forEach(e => e.x -= enemySpeed);
  enemies = enemies.filter(e => e.x + e.width > 0 && !e.hit);

  // Collisions
  for (let rocket of rockets) {
    for (let enemy of enemies) {
      if (!enemy.hit &&
          rocket.x < enemy.x + enemy.width &&
          rocket.x + rocket.width > enemy.x &&
          rocket.y < enemy.y + enemy.height &&
          rocket.y + rocket.height > enemy.y) {
        enemy.hit = true;
        rocket.hit = true;
        score++;
      }
    }
  }
}

// === Drawing ===
let backgroundX = 0;
function drawBackground() {
  ctx.fillStyle = '#a0d8ef';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#654321';
  ctx.fillRect(backgroundX, canvas.height - 40, canvas.width, 40);
  ctx.fillRect(backgroundX + canvas.width, canvas.height - 40, canvas.width, 40);
  backgroundX -= bgSpeed;
  if (backgroundX <= -canvas.width) backgroundX = 0;
}

function drawPlane() {
  if (planeExploded) {
    ctx.drawImage(imgExplosion, plane.x, plane.y, 50, 50);
  } else {
    ctx.save();
    ctx.translate(plane.x + plane.width / 2, plane.y + plane.height / 2);
    ctx.rotate((plane.angle * Math.PI) / 180);
    ctx.drawImage(imgPlane, -plane.width / 2, -plane.height / 2, plane.width, plane.height);
    ctx.restore();
  }
}

function drawEnemies() {
  for (let e of enemies) {
    if (!e.hit) {
      const img = e.type === 'tank' ? imgTank : imgHalftrack;
      ctx.drawImage(img, e.x, e.y, e.width, e.height);
    } else {
      ctx.drawImage(imgExplosion, e.x, e.y, 40, 30);
    }
  }
}

function drawRockets() {
  ctx.fillStyle = '#222';
  rockets.forEach(r => ctx.fillRect(r.x, r.y, r.width, r.height));
}

function drawScore() {
  ctx.fillStyle = 'black';
  ctx.font = '20px monospace';
  ctx.fillText(`Score: ${score}`, 10, 30);
}

function drawMenu() {
  drawBackground();
  ctx.fillStyle = 'black';
  ctx.font = '32px monospace';
  ctx.fillText('Bazooka Charlie: Sky Ace', 30, 200);

  ctx.font = '20px monospace';
  ctx.fillText('Press ENTER to Start', 130, 270);
  ctx.fillText('Controls:', 180, 300);
  ctx.fillText('- SPACE to Jump & Fire', 130, 330);

  // === Background Story ===
  ctx.font = '16px monospace';
  const storyLines = [
    'In a war-torn sky, only one pilot dares',
    'to fly solo — Captain "Bazooka" Charlie.',
    'Armed with just a modified plane and a',
    'bazooka strapped to its wing, he brings',
    'the fight to the Germans below.',
    '',
    'Dodge, dive, and destroy — the sky is yours.'
  ];
  storyLines.forEach((line, i) => {
    ctx.fillText(line, 40, 380 + i * 20);
  });
}


function drawGameOver() {
  ctx.fillStyle = 'red';
  ctx.font = '30px monospace';
  ctx.fillText('GAME OVER', canvas.width / 2 - 90, canvas.height / 2);
  ctx.font = '18px monospace';
  ctx.fillText(`Final Score: ${score}`, canvas.width / 2 - 70, canvas.height / 2 + 40);
  ctx.fillText('Press ENTER to Restart', canvas.width / 2 - 100, canvas.height / 2 + 70);
}

function gameLoop() {
  update();
  drawBackground();
  drawPlane();
  drawEnemies();
  drawRockets();
  drawScore();

  if (gameState === 'playing') {
    requestAnimationFrame(gameLoop);
  } else if (gameState === 'gameOver') {
    drawGameOver();
  }
}

// === Image Loading ===
let imagesLoaded = 0;
const totalImages = 4;
function checkAllImagesLoaded() {
  imagesLoaded++;
  if (imagesLoaded === totalImages) {
    drawMenu();
    setInterval(spawnEnemy, 1500);
  }
}
imgPlane.onload = checkAllImagesLoaded;
imgTank.onload = checkAllImagesLoaded;
imgHalftrack.onload = checkAllImagesLoaded;
imgExplosion.onload = checkAllImagesLoaded;
</script>
</body>
</html>
